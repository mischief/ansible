#
# {{ ansible_managed }}
#

ext_if = "{{ wan.interface }}"
int_if = "{{ lan.interface }}"

table <firewall> const { self }

set block-policy return
set skip on lo0

## skip packet processing on bridge members.
{% for intf in lan.interfaces %}
set skip on {{ intf }}
{% endfor %}

match out on egress inet from !(egress:network) to any nat-to (egress:0)

block in quick from urpf-failed label uRPF

block all

pass from <firewall>

pass out quick

pass in on $int_if

# ipv6 junk
pass in log on egress inet6 proto icmp6 all icmp6-type { routeradv neighbrsol neighbradv }
pass in log on egress inet6 proto udp from fe80::/10 port dhcpv6-server to fe80::/10 port dhcpv6-client no state

